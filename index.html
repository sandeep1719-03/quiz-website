<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Simple JEE Quiz</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
<style>
  body{font-family:Inter,sans-serif;background:#eef2ff;padding:16px;color:#0f172a;}
  .wrap{max-width:800px;margin:auto;}
  .card{background:white;padding:16px;border-radius:12px;box-shadow:0 5px 15px rgba(0,0,0,0.05);margin-bottom:14px;}
  input, select, button{padding:8px;border-radius:8px;border:1px solid #ccc;font-size:14px;}
  button{cursor:pointer;margin-top:6px;}
  img{max-width:100%;border-radius:12px;margin-top:6px;}
  .option-btn{padding:10px;margin:6px 0;background:#f8fafc;border:1px solid #ccc;border-radius:10px;cursor:pointer;}
  .option-btn.correct{background:rgba(16,185,129,0.2);border-color:green;}
  .option-btn.wrong{background:rgba(239,68,68,0.2);border-color:red;}
</style>
</head>
<body>
<div class="wrap">
  <h2>Simple JEE Quiz</h2>
  <div id="playerSection" class="card">
    <label>Enter your name:</label>
    <input id="playerNameInput" placeholder="Your name">
    <button id="saveNameBtn">Save</button>
  </div>

  <div id="hostSection" class="card">
    <h3>Upload Question (Host)</h3>
    <input type="file" id="imgInput" accept="image/*"><br>
    <input type="text" placeholder="Option A" id="opt0"><br>
    <input type="text" placeholder="Option B" id="opt1"><br>
    <input type="text" placeholder="Option C" id="opt2"><br>
    <input type="text" placeholder="Option D" id="opt3"><br>
    <label>Select correct option:</label>
    <select id="correctSelect">
      <option value="0">A</option>
      <option value="1">B</option>
      <option value="2">C</option>
      <option value="3">D</option>
    </select><br>
    <button id="uploadBtn">Upload Question</button>
    <button id="showBtn">Show to Friend</button>
  </div>

  <div id="friendView" class="card">
    <h3>Friend's View</h3>
    <div id="questionsContainer"></div>
  </div>
</div>

<!-- Firebase -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.6.1/firebase-app.js";
import { getFirestore, collection, addDoc, updateDoc, doc, query, where, onSnapshot, orderBy, getDocs, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.6.1/firebase-firestore.js";
import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.6.1/firebase-storage.js";

const firebaseConfig = {
  apiKey: "AIzaSyDZWch8bUUF164Red-MoQCOqgPu-PHHSGU",
  authDomain: "jee-quiz-71912.firebaseapp.com",
  projectId: "jee-quiz-71912",
  storageBucket: "jee-quiz-71912.appspot.com",
  messagingSenderId: "212496360778",
  appId: "1:212496360778:web:1e148d744568160bd98db3",
  measurementId: "G-GDCG60YF22"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const storage = getStorage(app);

let player = localStorage.getItem('playerName') || '';
document.getElementById('playerNameInput').value = player;

document.getElementById('saveNameBtn').onclick = ()=>{
  const name = document.getElementById('playerNameInput').value.trim();
  if(name){ player = name; localStorage.setItem('playerName', name); alert('Saved!'); }
};

// Upload question
document.getElementById('uploadBtn').onclick = async ()=>{
  const opts = [0,1,2,3].map(i=>document.getElementById('opt'+i).value.trim());
  if(opts.some(o=>o==='')) return alert('Fill all options');
  const correct = Number(document.getElementById('correctSelect').value);
  let imageurl = '';
  const fileInput = document.getElementById('imgInput');
  if(fileInput.files[0]){
    const f = fileInput.files[0];
    const storageRef = ref(storage, 'questions/'+Date.now()+'_'+f.name);
    await uploadBytes(storageRef,f);
    imageurl = await getDownloadURL(storageRef);
  }
  await addDoc(collection(db,'questions'),{
    options: opts,
    correct: correct,
    imageurl: imageurl,
    visible:false,
    timestamp: serverTimestamp()
  });
  alert('Question uploaded (hidden)');
};

// Show question to friend
document.getElementById('showBtn').onclick = async ()=>{
  const q = query(collection(db,'questions'), orderBy('timestamp','desc'), limit(1));
  const snap = await getDocs(q);
  if(snap.docs.length){
    const last = snap.docs[0];
    await updateDoc(doc(db,'questions',last.id), {visible:true});
    alert('Question is now visible!');
  }
};

// Friend view
const container = document.getElementById('questionsContainer');
const qRef = query(collection(db,'questions'), where('visible','==',true), orderBy('timestamp'));
onSnapshot(qRef, snap=>{
  container.innerHTML = '';
  snap.docs.forEach(docSnap=>{
    const data = docSnap.data();
    const div = document.createElement('div');
    div.className = 'card';
    div.innerHTML = `
      ${data.imageurl?'<img src="'+data.imageurl+'">':''}
      ${data.options.map((o,i)=>'<div class="option-btn">'+['A','B','C','D'][i]+'. '+o+'</div>').join('')}
    `;
    container.appendChild(div);
  });
});
</script>
</body>
</html>
